var today = new Date();

var year = today.getUTCFullYear();
var month = ('0' + (today.getUTCMonth() + 1)).slice(-2);
var day = ('0' + today.getUTCDate()).slice(-2);
var hours = ('0' + today.getUTCHours()).slice(-2);
var minutes = ('0' + today.getUTCMinutes()).slice(-2);
var seconds = ('0' + today.getUTCSeconds()).slice(-2);

// Initialize the variables "refresh_cnt" and "resp_URL" to 0 and an empty string respectively
var refresh_cnt = 0;
var resp_URL = '';

var updated_ts = '"' + year + '-' + month + '-' + day + ' ' + hours + ':' + minutes + ':' + seconds + '"';

// sequentialy  us_la(22) tokyo(25) deksf3(31) dehaj1(33) denue1(34) fihel1spw(39) frviy(42) sgsin(44) belgg1(46) esmad1(49) ausyd1(51) krgmp(54) ustys(58)
//var monitor_ID = ["22", "25", "31", "33", "34", "38", "42", "44", "46", "49", "51", "54", "58"];
// 234 ntp servers
var beta_NTP_servers = ["103.100.31.24","104.237.139.208","109.202.196.249","116.91.118.97","129.132.121.177","129.146.131.8","129.146.140.235","129.146.193.200","129.146.64.32","129.153.205.81","130.133.1.10","132.163.97.3","133.243.238.163","133.243.238.164","133.243.238.243","133.243.238.244","134.34.3.18","134.34.3.19","139.59.15.185","139.99.222.72","143.107.229.210","143.107.229.211","144.172.118.20","144.76.76.107","145.53.70.25","147.251.48.140","148.251.6.18","150.101.186.48","150.101.186.50","151.237.71.222","152.67.232.7","155.248.196.28","156.106.214.48","156.106.214.52","159.2.216.215","160.119.216.197","160.119.216.202","160.119.216.206","161.53.131.133","161.53.131.231","161.53.131.232","161.53.131.81","163.152.23.172","164.67.62.212","168.96.251.195","168.96.251.197","169.229.128.134","17.253.16.253","17.253.34.125","17.253.54.253","170.187.158.81","172.104.193.207","172.105.3.84","173.164.210.49","174.142.148.226","176.9.157.155","178.16.23.50","178.215.228.24","178.63.9.212","185.11.138.90","185.117.82.66","185.117.82.71","185.120.22.12","185.134.196.169","185.16.60.96","185.19.184.35","185.209.85.222","185.216.161.42","185.224.188.4","185.47.76.20","185.47.76.21","188.165.194.26","192.3.29.143","192.36.143.150","192.36.143.151","192.36.143.153","192.42.42.154","192.81.223.51","192.95.27.155","193.104.228.123","193.136.152.71","193.136.152.72","193.136.164.4","193.162.159.194","193.173.62.123","193.175.73.20","193.182.111.12","193.182.111.13","193.182.111.14","193.182.111.141","193.182.111.142","193.182.111.143","193.239.221.29","193.31.26.254","193.5.60.8","193.5.60.9","194.0.5.123","194.100.49.139","194.100.49.151","194.100.49.152","194.104.0.153","194.117.9.130","194.117.9.136","194.55.13.112","194.55.13.132","194.58.200.20","195.112.113.253","198.169.208.142","198.211.103.209","200.160.0.8","200.160.7.186","200.186.125.195","200.189.40.8","200.192.232.8","202.124.96.215","202.90.244.29","203.217.19.190","204.145.72.158","206.108.0.131","206.108.0.132","208.81.1.197","212.138.72.41","212.138.72.43","212.159.133.82","212.159.133.83","212.159.133.84","212.26.18.41","212.26.18.43","212.51.144.44","212.51.144.46","212.92.16.193","213.10.191.252","213.144.138.218","213.239.154.12","213.240.145.46","216.177.181.129","217.155.2.22","217.198.219.102","217.70.19.12","23.94.200.138","24.134.53.145","31.125.71.204","37.120.164.45","37.122.249.178","37.122.249.190","37.187.108.161","37.221.199.157","45.33.103.94","45.33.37.82","45.33.68.112","45.76.113.31","45.77.101.222","45.79.214.107","5.196.189.119","50.21.181.14","50.7.177.195","51.174.46.115","51.68.44.27","51.75.67.47","54.38.193.17","54.39.23.64","58.176.194.96","61.205.120.130","61.239.100.196","62.12.167.109","62.197.224.14","62.212.95.42","62.220.129.71","62.3.77.1","62.3.77.2","66.130.142.231","66.42.45.108","69.196.158.106","72.14.181.128","73.239.136.185","77.109.90.72","78.130.168.61","78.46.102.180","79.140.186.212","79.161.39.253","80.229.12.212","80.69.163.42","80.92.90.190","80.92.90.191","81.174.128.183","81.174.133.68","81.187.77.191","81.2.248.189","81.99.29.43","82.152.150.47","82.168.89.20","83.137.225.103","83.137.225.123","83.143.51.50","83.98.155.30","84.87.77.146","85.119.80.232","85.119.80.233","85.195.224.28","85.199.214.222","85.254.217.2","85.254.217.3","85.254.217.5","86.110.169.234","86.85.103.243","87.48.12.70","87.75.224.75","88.198.52.243","88.222.88.11","88.96.67.59","89.111.47.130","89.111.54.85","89.179.240.219","89.207.129.63","89.221.210.188","89.221.214.130","90.155.73.34","90.155.76.161","91.189.172.27","92.243.6.5","93.162.41.228","93.81.254.125","94.130.49.186","94.141.63.150","94.198.159.11","94.198.159.15","94.198.159.16","94.228.143.152","94.228.220.14","94.230.211.37","98.191.213.12","98.191.213.14","98.191.213.2","98.191.213.7"];

//const vm = require('vm');

//async function main() {
function main() {

  setInterval(network_delay_change, 3000); // every 3sec=3000

} // main end

// The following is a JavaScript function that crawls a website and saves its content into a file.
async function network_delay_change() {

const axios = require('axios');
const cheerio = require('cheerio');
const fs = require('fs');
const path = require("path");
// The beta_NTP_servers array is being used to store server names.
  console.log ("NTP Server : " + beta_NTP_servers[refresh_cnt]);
  // The resp_URL variable stores the URL to be crawled.
  resp_URL = '';
  resp_URL = 'https://web.beta.grundclock.com/scores/'+ beta_NTP_servers[refresh_cnt] + '/log?limit=400&monitor=*';
  console.log ("resp URL : " + resp_URL);
  // Axios is being used to send an HTTP GET request to the website.
  var resp = await axios.get(resp_URL);
  
  // Cheerio is a library for parsing HTML and XML documents, and it's being used here to extract the HTML code of the website.
  const $ = cheerio.load(resp.data);

  const extractedCode = $('body').first().html();
  // The extracted HTML code is being appended to the beta_log.txt file along with the server name.
  var extractedStr = extractedCode;
  fs.appendFile('/home/isslab_owner/바탕화면/ntpservercrawl/script/experi_2/beta_log.txt', beta_NTP_servers[refresh_cnt] + ',' +extractedStr, err => {
    if (err) {
      console.error(err)
      return;
    }
  })
  console.log ("resp URL : " + resp_URL + " >> Logged!");
  // The refresh_cnt variable is being incremented to prepare for the next crawl.
refresh_cnt++;
  return refresh_cnt;
}

main();
